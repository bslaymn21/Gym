<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬ÙŠÙ…</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-dumbbell"></i>
                    </div>
                    <h1>GYM <span>MANAGER</span></h1>
                </div>
                <button class="sidebar-close" id="sidebarClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-profile">
                <div class="profile-img">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=0f4c75&color=fff" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="profile-info">
                    <h3 id="userName">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</h3>
                    <p id="userRole">Ù…Ø³Ø¤ÙˆÙ„</p>
                    <span class="status online" id="userStatus">Ù…ØªØµÙ„</span>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <ul>
                    <li>
                        <a href="dashboard.html">
                            <i class="fas fa-home"></i>
                            <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="members.html">
                            <i class="fas fa-users"></i>
                            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
                        </a>
                    </li>
                    <li>
                        <a href="renew.html">
                            <i class="fas fa-redo"></i>
                            <span>ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
                        </a>
                    </li>
                    <li>
                        <a href="calendar.html">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
                        </a>
                    </li>
                    <li>
                        <a href="subscriptions.html">
                            <i class="fas fa-credit-card"></i>
                            <span>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
                        </a>
                    </li>
                    <li>
                        <a href="settings.html">
                            <i class="fas fa-cog"></i>
                            <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                </button>
            </div>
        </aside>
        
        <!-- Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ¹ØªÙŠÙ… Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <main class="main-content">
            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
            <header class="top-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø¶Ùˆ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯...">
                        <button class="clear-search" id="clearSearchBtn">
                            <i class="fas fa-times"></i>
                        </button>
                        <button class="search-btn" id="searchBtn">Ø¨Ø­Ø«</button>
                    </div>
                    <div class="search-results" id="searchResults"></div>
                </div>
                
                <div class="header-right">
                    <button class="notifications-btn" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count" id="notificationCount">0</span>
                    </button>
                    
                    <div class="user-menu">
                        <div class="user-info">
                            <span id="headerUserName">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</span>
                            <small>Ù…Ø³Ø¤ÙˆÙ„</small>
                        </div>
                        <div class="user-avatar">
                            <img src="https://ui-avatars.com/api/?name=Admin&background=0f4c75&color=fff" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Ù…Ø­ØªÙˆÙ‰ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ -->
            <div class="dashboard-content">
                <div class="page-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
                    <p>Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¥Ø¶Ø§ÙØ© ÙˆØªØ¬Ø¯ÙŠØ¯ ÙˆØ¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
                <div class="control-actions">
                    <button class="btn-primary" id="addMemberBtn">
                        <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯
                    </button>
                    <button class="btn-secondary" id="renewMembershipBtn">
                        <i class="fas fa-redo"></i> ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ
                    </button>
                    <button class="btn-danger" id="cancelMembershipBtn">
                        <i class="fas fa-user-times"></i> Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ
                    </button>
                    
                    <div class="filter-group">
                        <select id="filterStatus">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</option>
                            <option value="active">Ø§Ù„Ù†Ø´Ø·ÙŠÙ† ÙÙ‚Ø·</option>
                            <option value="expired">Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ Ø§Ø´ØªØ±Ø§ÙƒÙ‡Ù…</option>
                            <option value="about-to-expire">Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</option>
                        </select>
                    </div>
                </div>
                
                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
                        <div class="table-actions">
                            <span id="membersCount">0 Ø¹Ø¶Ùˆ</span>
                          
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="members-table" id="membersTable">
                            <thead>
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" id="selectAll">
                                    </th>
                                    <th width="100">ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¶Ùˆ</th>
                                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                                    <th width="80">Ø§Ù„Ø¹Ù…Ø±</th>
                                    <th width="80">Ø§Ù„Ø¬Ù†Ø³</th>
                                    <th width="120">Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                                    <th width="120">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</th>
                                    <th width="120">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                    <th width="100">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th width="150">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-footer">
                        <div class="pagination">
                            <button class="pagination-btn" id="prevPageBtn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <span class="page-numbers">
                                <span class="current-page">1</span> Ù…Ù† <span class="total-pages">1</span>
                            </span>
                            <button class="pagination-btn" id="nextPageBtn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        </div>
                        
                        <div class="rows-per-page">
                            <span>Ø¹Ø±Ø¶</span>
                            <select id="rowsPerPage">
                                <option value="10">10</option>
                                <option value="25" selected>25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span>ØµÙ ÙÙŠ ÙƒÙ„ ØµÙØ­Ø©</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯ -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-group">
                        <label for="memberName">Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ *</label>
                        <input type="text" id="memberName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="memberAge">Ø§Ù„Ø¹Ù…Ø± *</label>
                            <input type="number" id="memberAge" min="16" max="70" required>
                        </div>
                        <div class="form-group">
                            <label for="memberGender">Ø§Ù„Ø¬Ù†Ø³ *</label>
                            <select id="memberGender" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                                <option value="male">Ø°ÙƒØ±</option>
                                <option value="female">Ø£Ù†Ø«Ù‰</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="memberPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                        <input type="tel" id="memberPhone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="memberPackage">Ø§Ù„Ø¨Ø§Ù‚Ø© *</label>
                        <select id="memberPackage" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="memberPayment">ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
                        <select id="memberPayment" required>
                            <option value="">Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹</option>
                            <option value="ÙƒØ§Ø´">ÙƒØ§Ø´</option>
                            <option value="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                            <option value="Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ">Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ</option>
                            <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="memberStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ *</label>
                        <input type="date" id="memberStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="memberDuration">Ø§Ù„Ù…Ø¯Ø© (Ø£Ø´Ù‡Ø±)</label>
                        <select id="memberDuration">
                            <option value="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯</option>
                            <option value="3">3 Ø£Ø´Ù‡Ø±</option>
                            <option value="6">6 Ø£Ø´Ù‡Ø±</option>
                            <option value="12">12 Ø´Ù‡Ø±</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ</button>
                        <button type="button" class="btn-secondary close-modal">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ -->
    <div id="memberDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="member-details" id="memberDetailsContent">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="editMemberBtn">ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="btn-primary" id="renewMemberBtn">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
                <button class="btn-danger" id="cancelMemberBtn">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
    <div id="renewMembershipModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¹Ø¶Ùˆ</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="renewMembershipForm">
                    <div class="form-group">
                        <label for="renewMemberName">Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</label>
                        <input type="text" id="renewMemberName" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="renewMemberCode">ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¶Ùˆ</label>
                        <input type="text" id="renewMemberCode" readonly>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="renewPackage">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© *</label>
                            <select id="renewPackage" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="renewDuration">Ø§Ù„Ù…Ø¯Ø© (Ø£Ø´Ù‡Ø±) *</label>
                            <select id="renewDuration" required>
                                <option value="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯</option>
                                <option value="3">3 Ø£Ø´Ù‡Ø±</option>
                                <option value="6">6 Ø£Ø´Ù‡Ø±</option>
                                <option value="12">12 Ø´Ù‡Ø±</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="renewPayment">ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
                        <select id="renewPayment" required>
                            <option value="">Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹</option>
                            <option value="ÙƒØ§Ø´">ÙƒØ§Ø´</option>
                            <option value="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
                            <option value="Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ">Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ</option>
                            <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="renewStartDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ *</label>
                        <input type="date" id="renewStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="renewAmount">Ø§Ù„Ù…Ø¨Ù„Øº *</label>
                        <input type="number" id="renewAmount" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
                        <button type="button" class="btn-secondary close-modal">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
    /**
     * Ø³ÙƒØ±ÙŠØ¨Øª Ø®Ø§Øµ Ø¨ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
     */
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØµÙØ­Ø©
    let currentPage = 1;
    let rowsPerPage = 25;
    let filteredMembers = [];
    
    // ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
    function initMembersPage() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        loadMembers();
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        initEvents();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
        updateCounters();
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
    function loadMembers() {
        const filter = document.getElementById('filterStatus').value;
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
        filteredMembers = applyFilter(subscriptions, filter);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        renderMembersTable();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø­ÙŠÙ…
        updatePagination();
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø©
    function applyFilter(members, filterType) {
        switch(filterType) {
            case 'active':
                return members.filter(m => m.status === 'active');
                
            case 'expired':
                return members.filter(m => {
                    if (m.status === 'expired') return true;
                    
                    const endDate = new Date(m.endDate);
                    const today = new Date();
                    return endDate < today && m.status === 'active';
                });
                
            case 'about-to-expire':
                return members.filter(m => {
                    if (m.status !== 'active') return false;
                    
                    const endDate = new Date(m.endDate);
                    const today = new Date();
                    const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                    
                    return daysUntilExpiry <= 7 && daysUntilExpiry > 0;
                });
                
            default:
                return members;
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function renderMembersTable() {
        const tbody = document.getElementById('membersTableBody');
        if (!tbody) return;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;
        const pageMembers = filteredMembers.slice(startIndex, endIndex);
        
        if (pageMembers.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="10" class="no-data">
                        <i class="fas fa-users-slash"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ù„Ø¹Ø±Ø¶Ù‡Ù…</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        let tableHtml = '';
        
        pageMembers.forEach(member => {
            // Ø­Ø³Ø§Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            const statusInfo = getMemberStatus(member);
            
            tableHtml += `
                <tr data-id="${member.id}">
                    <td>
                        <input type="checkbox" class="member-checkbox" data-id="${member.id}">
                    </td>
                    <td>
                        <span class="member-code">${member.id}</span>
                    </td>
                    <td>
                        <div class="member-name">
                            <div class="avatar">
                                ${member.gender === 'male' ? 'ğŸ‘¨' : 'ğŸ‘©'}
                            </div>
                            <div>
                                <strong>${member.name}</strong>
                                <small>${member.phone}</small>
                            </div>
                        </div>
                    </td>
                    <td>${member.age}</td>
                    <td>
                        <span class="gender-badge ${member.gender}">
                            ${member.gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰'}
                        </span>
                    </td>
                    <td>
                        <span class="package-name">${member.package}</span>
                        <small>${member.price} Ø¬.Ù…</small>
                    </td>
                    <td>${formatDate(member.startDate)}</td>
                    <td>
                        <span class="end-date ${statusInfo.class}">
                            ${formatDate(member.endDate)}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${statusInfo.class}">
                            ${statusInfo.text}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-view" data-id="${member.id}" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-edit" data-id="${member.id}" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-renew" data-id="${member.id}" title="ØªØ¬Ø¯ÙŠØ¯">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        tbody.innerHTML = tableHtml;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
        attachRowEvents();
    }
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
    function getMemberStatus(member) {
        if (member.status !== 'active') {
            return {
                class: 'expired',
                text: 'Ù…Ù†ØªÙ‡ÙŠ'
            };
        }
        
        const endDate = new Date(member.endDate);
        const today = new Date();
        const daysUntilExpiry = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
        
        if (daysUntilExpiry <= 0) {
            return {
                class: 'expired',
                text: 'Ù…Ù†ØªÙ‡ÙŠ'
            };
        } else if (daysUntilExpiry <= 7) {
            return {
                class: 'warning',
                text: `ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ ${daysUntilExpiry} Ø£ÙŠØ§Ù…`
            };
        } else {
            return {
                class: 'active',
                text: 'Ù†Ø´Ø·'
            };
        }
    }
    
    // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-EG', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function attachRowEvents() {
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶
        document.querySelectorAll('.btn-view').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                showMemberDetails(memberId);
            });
        });
        
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        document.querySelectorAll('.btn-edit').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                editMember(memberId);
            });
        });
        
        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
        document.querySelectorAll('.btn-renew').forEach(btn => {
            btn.addEventListener('click', function() {
                const memberId = this.getAttribute('data-id');
                const member = subscriptions.find(m => m.id === memberId);
                if (member) openRenewModal(member);
            });
        });
        
        // Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ±Ø¯ÙŠ
        document.querySelectorAll('.member-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectAll);
        });
    }
    
    // Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function initEvents() {
        // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯
        const addMemberBtn = document.getElementById('addMemberBtn');
        if (addMemberBtn) {
            addMemberBtn.addEventListener('click', () => {
                prepareAddMemberForm();
                openModal('addMemberModal');
            });
        }
        
        // Ø²Ø± ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ
        const renewBtn = document.getElementById('renewMembershipBtn');
        if (renewBtn) {
            renewBtn.addEventListener('click', () => {
                const selected = getSelectedMembers();
                if (selected.length === 0) {
                    showAlert('ØªØ­Ø°ÙŠØ±', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¶Ùˆ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', false);
                    return;
                }
                if (selected.length > 1) {
                    showAlert('ØªØ­Ø°ÙŠØ±', 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø¯ÙŠØ¯ Ø¹Ø¶Ùˆ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©', false);
                    return;
                }
                openRenewModal(selected[0]);
            });
        }
        
        // Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ
        const cancelBtn = document.getElementById('cancelMembershipBtn');
        if (cancelBtn) {
            cancelBtn.addEventListener('click', () => {
                const selected = getSelectedMembers();
                if (selected.length === 0) {
                    showAlert('ØªØ­Ø°ÙŠØ±', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¶Ùˆ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', false);
                    return;
                }
                if (selected.length > 1) {
                    showAlert('ØªØ­Ø°ÙŠØ±', 'ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù„ØºØ§Ø¡ Ø¹Ø¶Ùˆ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©', false);
                    return;
                }
                cancelMembership(selected[0]);
            });
        }
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
        const filterStatus = document.getElementById('filterStatus');
        if (filterStatus) {
            filterStatus.addEventListener('change', () => {
                currentPage = 1;
                loadMembers();
            });
        }
        
        // Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
        const rowsSelect = document.getElementById('rowsPerPage');
        if (rowsSelect) {
            rowsSelect.addEventListener('change', function() {
                rowsPerPage = parseInt(this.value);
                currentPage = 1;
                loadMembers();
            });
        }
        
        // Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ
        const selectAll = document.getElementById('selectAll');
        if (selectAll) {
            selectAll.addEventListener('change', function() {
                document.querySelectorAll('.member-checkbox').forEach(cb => {
                    cb.checked = this.checked;
                });
                updateSelectionCount();
            });
        }
        
        // Ø§Ù„ØªØ±Ø­ÙŠÙ…
        const prevBtn = document.getElementById('prevPageBtn');
        const nextBtn = document.getElementById('nextPageBtn');
        
        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadMembers();
                }
            });
        }
        
        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredMembers.length / rowsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    loadMembers();
                }
            });
        }
        
        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', exportMembersData);
        }
        
        // Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
        const addMemberForm = document.getElementById('addMemberForm');
        if (addMemberForm) {
            addMemberForm.addEventListener('submit', handleAddMember);
        }
        
        // Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ
        const renewForm = document.getElementById('renewMembershipForm');
        if (renewForm) {
            renewForm.addEventListener('submit', handleRenewMembership);
        }
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¶ÙŠØ± Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
    function prepareAddMemberForm() {
        // ØªØ¹Ø¨Ø¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        const packageSelect = document.getElementById('memberPackage');
        if (packageSelect) {
            packageSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</option>';
            packages.forEach(pkg => {
                const option = document.createElement('option');
                option.value = pkg.name;
                option.textContent = `${pkg.name} - ${pkg.price} Ø¬.Ù…`;
                packageSelect.appendChild(option);
            });
        }
        
        // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('memberStartDate').value = today;
    }
    
    // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
    async function handleAddMember(e) {
        e.preventDefault();
        
        const memberData = {
            name: document.getElementById('memberName').value.trim(),
            age: parseInt(document.getElementById('memberAge').value),
            gender: document.getElementById('memberGender').value,
            phone: document.getElementById('memberPhone').value.trim(),
            package: document.getElementById('memberPackage').value,
            paymentMethod: document.getElementById('memberPayment').value,
            startDate: document.getElementById('memberStartDate').value,
            duration: parseInt(document.getElementById('memberDuration').value)
        };
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!validateMemberData(memberData)) return;
        
        // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¶Ùˆ
        const memberId = generateMemberId();
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„Ø¨Ø§Ù‚Ø©
        const packageInfo = packages.find(p => p.name === memberData.package);
        const price = packageInfo ? packageInfo.price : 300;
        
        // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
        const endDate = new Date(memberData.startDate);
        endDate.setMonth(endDate.getMonth() + memberData.duration);
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const currentUser = getCurrentUser();
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const newMember = {
            id: memberId,
            name: memberData.name,
            age: memberData.age,
            gender: memberData.gender,
            phone: memberData.phone,
            package: memberData.package,
            startDate: memberData.startDate,
            endDate: endDate.toISOString().split('T')[0],
            paymentMethod: memberData.paymentMethod,
            price: price,
            addedBy: currentUser.username,
            status: 'active'
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ
        subscriptions.push(newMember);
        
        // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
        const newActivity = {
            id: activities.length + 1,
            type: 'Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯',
            user: memberData.name,
            amount: price,
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }),
            details: `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ - ${memberData.package}`
        };
        
        activities.unshift(newActivity);
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        saveData();
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        closeModal('addMemberModal');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        loadMembers();
        updateCounters();
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        showAlert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©', `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ ${memberData.name} Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù„ÙƒÙˆØ¯: ${memberId}`, true);
    }
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ
    function validateMemberData(data) {
        if (!data.name || data.name.length < 2) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­', false);
            return false;
        }
        
        if (data.age < 16 || data.age > 70) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù…Ø± Ø¨ÙŠÙ† 16 Ùˆ 70 Ø³Ù†Ø©', false);
            return false;
        }
        
        if (!data.phone || data.phone.length < 10) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­', false);
            return false;
        }
        
        if (!data.package) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø§Ù‚Ø©', false);
            return false;
        }
        
        if (!data.paymentMethod) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© Ø¯ÙØ¹', false);
            return false;
        }
        
        if (!data.startDate) {
            showAlert('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡', false);
            return false;
        }
        
        return true;
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ
    function showMemberDetails(memberId) {
        const member = subscriptions.find(m => m.id === memberId);
        if (!member) return;
        
        const content = document.getElementById('memberDetailsContent');
        if (!content) return;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
        const endDate = new Date(member.endDate);
        const today = new Date();
        const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        content.innerHTML = `
            <div class="member-header">
                <div class="member-avatar-large">
                    ${member.gender === 'male' ? 'ğŸ‘¨' : 'ğŸ‘©'}
                </div>
                <div class="member-info">
                    <h4>${member.name}</h4>
                    <p>ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø¶Ùˆ: <strong>${member.id}</strong></p>
                    <span class="status-badge ${member.status === 'active' ? 'active' : 'expired'}">
                        ${member.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…Ù†ØªÙ‡ÙŠ'}
                    </span>
                </div>
            </div>
            
            <div class="member-details-grid">
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ø¹Ù…Ø±:</span>
                    <span class="detail-value">${member.age} Ø³Ù†Ø©</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ø¬Ù†Ø³:</span>
                    <span class="detail-value">${member.gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰'}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ù‡Ø§ØªÙ:</span>
                    <span class="detail-value">${member.phone}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ø¨Ø§Ù‚Ø©:</span>
                    <span class="detail-value">${member.package}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ø³Ø¹Ø±:</span>
                    <span class="detail-value">${member.price} Ø¬.Ù…</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</span>
                    <span class="detail-value">${formatDate(member.startDate)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span>
                    <span class="detail-value">${formatDate(member.endDate)}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</span>
                    <span class="detail-value ${daysRemaining <= 7 ? 'warning' : 'success'}">
                        ${daysRemaining > 0 ? daysRemaining + ' ÙŠÙˆÙ…' : 'Ø§Ù†ØªÙ‡Ù‰'}
                    </span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                    <span class="detail-value">${member.paymentMethod}</span>
                </div>
            </div>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
        const editBtn = document.getElementById('editMemberBtn');
        const renewBtn = document.getElementById('renewMemberBtn');
        const cancelBtn = document.getElementById('cancelMemberBtn');
        
        if (editBtn) editBtn.onclick = () => editMember(memberId);
        if (renewBtn) renewBtn.onclick = () => openRenewModal(member);
        if (cancelBtn) cancelBtn.onclick = () => cancelMembership(member);
        
        // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        openModal('memberDetailsModal');
    }
    
    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    function openRenewModal(member) {
        if (!member) return;
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('renewMemberName').value = member.name;
        document.getElementById('renewMemberCode').value = member.id;
        document.getElementById('renewPackage').value = member.package;
        document.getElementById('renewAmount').value = member.price;
        
        // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('renewStartDate').value = today;
        
        // ØªØ¹Ø¨Ø¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        const packageSelect = document.getElementById('renewPackage');
        if (packageSelect) {
            packageSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</option>';
            packages.forEach(pkg => {
                const option = document.createElement('option');
                option.value = pkg.name;
                option.textContent = `${pkg.name} - ${pkg.price} Ø¬.Ù…`;
                packageSelect.appendChild(option);
            });
            packageSelect.value = member.package;
        }
        
        // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        openModal('renewMembershipModal');
    }
    
    // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    async function handleRenewMembership(e) {
        e.preventDefault();
        
        const memberCode = document.getElementById('renewMemberCode').value;
        const member = subscriptions.find(m => m.id === memberCode);
        if (!member) return;
        
        const renewData = {
            package: document.getElementById('renewPackage').value,
            duration: parseInt(document.getElementById('renewDuration').value),
            paymentMethod: document.getElementById('renewPayment').value,
            startDate: document.getElementById('renewStartDate').value,
            amount: parseInt(document.getElementById('renewAmount').value)
        };
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ
        member.package = renewData.package;
        member.startDate = renewData.startDate;
        
        // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const endDate = new Date(renewData.startDate);
        endDate.setMonth(endDate.getMonth() + renewData.duration);
        member.endDate = endDate.toISOString().split('T')[0];
        
        member.paymentMethod = renewData.paymentMethod;
        member.price = renewData.amount;
        member.status = 'active';
        
        // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
        const newActivity = {
            id: activities.length + 1,
            type: 'ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ',
            user: member.name,
            amount: renewData.amount,
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }),
            details: `ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ - ${renewData.package}`
        };
        
        activities.unshift(newActivity);
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        saveData();
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        closeModal('renewMembershipModal');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        loadMembers();
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        showAlert('ØªÙ… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯', `ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§Ùƒ ${member.name} Ø¨Ù†Ø¬Ø§Ø­`, true);
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ
    async function cancelMembership(member) {
        const confirmed = await showAlert(
            'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡',
            `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ ${member.name}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`,
            false
        );
        
        if (!confirmed) return;
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
        member.status = 'cancelled';
        
        // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø§Ù„Ø¥Ù„ØºØ§Ø¡
        const newActivity = {
            id: activities.length + 1,
            type: 'Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ',
            user: member.name,
            amount: 0,
            date: new Date().toISOString().split('T')[0],
            time: new Date().toLocaleTimeString('ar-EG', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }),
            details: 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'
        };
        
        activities.unshift(newActivity);
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        saveData();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        loadMembers();
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        showAlert('ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡', `ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ ${member.name} Ø¨Ù†Ø¬Ø§Ø­`, true);
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ
    function editMember(memberId) {
        // ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù†ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø«Ù… Ø§Ù„Ø²Ø±
        showMemberDetails(memberId);
        
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ÙØµÙ„ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
        showAlert('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø®Ø§ØµÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', false);
    }
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†
    function getSelectedMembers() {
        const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
        const selectedMembers = [];
        
        selectedCheckboxes.forEach(checkbox => {
            const memberId = checkbox.getAttribute('data-id');
            const member = subscriptions.find(m => m.id === memberId);
            if (member) selectedMembers.push(member);
        });
        
        return selectedMembers;
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ
    function updateSelectAll() {
        const selectAll = document.getElementById('selectAll');
        if (!selectAll) return;
        
        const checkboxes = document.querySelectorAll('.member-checkbox');
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        
        selectAll.checked = allChecked;
        updateSelectionCount();
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    function updateSelectionCount() {
        const selectedCount = document.querySelectorAll('.member-checkbox:checked').length;
        // ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø¯ ÙÙŠ Ù…ÙƒØ§Ù† Ù…Ù†Ø§Ø³Ø¨
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø­ÙŠÙ…
    function updatePagination() {
        const totalPages = Math.ceil(filteredMembers.length / rowsPerPage);
        
        document.querySelector('.current-page').textContent = currentPage;
        document.querySelector('.total-pages').textContent = totalPages;
        
        const prevBtn = document.getElementById('prevPageBtn');
        const nextBtn = document.getElementById('nextPageBtn');
        
        if (prevBtn) prevBtn.disabled = currentPage === 1;
        if (nextBtn) nextBtn.disabled = currentPage === totalPages;
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
    function updateCounters() {
        const membersCount = document.getElementById('membersCount');
        if (membersCount) {
            membersCount.textContent = `${filteredMembers.length} Ø¹Ø¶Ùˆ`;
        }
    }
    
    // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
    function exportMembersData() {
        const dataStr = JSON.stringify(filteredMembers, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
        
        const exportFileName = `Ø£Ø¹Ø¶Ø§Ø¡_Ø§Ù„Ø¬ÙŠÙ…_${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileName);
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
        
        showAlert('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­', true);
    }
    
    // ØªØ´ØºÙŠÙ„ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.addEventListener('DOMContentLoaded', () => {
        initMembersPage();
    });
    </script>
</body>
</html>